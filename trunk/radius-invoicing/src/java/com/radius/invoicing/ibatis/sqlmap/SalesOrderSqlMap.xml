<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="salesOrderSqlMap">

  <typeAlias alias="salesOrder" type="com.radius.invoicing.ibatis.model.SalesOrder" />
  
  <sql id="salesOrderFileds">
  	 sales_order_id salesOrderId,customer_id customerId,customer_name customerName,link_man linkMan,link_mobile mobile,tel tel,fax fax,
  	 contract_id contractId,total_amount totalAmount,amount_in_words upperAmount,ordered_date orderedDate,delivery_date deliveryDate,
  	 delivery_address deliveryAddress,terms terms,memo memo,status status,splited_flg splitedFlg,splited_sales_order_id spliteSalesOrderId,
  	 print_times printTimes,newest_print_time newestPrintTime,newest_print_acc newestPrintAcc,newest_print_record newestPrintRecord,salesman_id salesManId,
  	 ledger_id ledgerId,operator operator,motify_date modifyDate,creater creater,createdate createDate,reviser reviser,revisedate reviseDate,verifier verifier,verifydate verifyDate
  </sql>
  
  <resultMap id="salesOrder" class="salesOrder">
	 <result column="sales_order_id" jdbcType="char" javaType="java.lang.String" property="salesOrderId" />
	 <result column="customer_id" jdbcType="char" javaType="java.lang.String" property="customerId" />
	 <result column="customer_name" jdbcType="char" javaType="java.lang.String" property="customerName" />
  	 <result column="link_man" jdbcType="char" javaType="java.lang.String" property="linkMan" />
  	 <result column="link_mobile" jdbcType="char" javaType="java.lang.String" property="mobile" />
  	 <result column="tel" jdbcType="char" javaType="java.lang.String" property="tel" />
  	 <result column="fax" jdbcType="char" javaType="java.lang.String" property="fax" />
  	 <result column="contract_id" jdbcType="char" javaType="java.lang.String" property="contractId" />
  	 <result column="total_amount" jdbcType="int" javaType="java.lang.Integer" property="totalAmount" />
	 <result column="amount_in_words" jdbcType="char" javaType="java.lang.String" property="upperAmount" />
	 <result column="ordered_date" jdbcType="date" javaType="java.util.Date" property="orderedDate" />
  	 <result column="delivery_date" jdbcType="date" javaType="java.util.Date" property="deliveryDate" />
  	 <result column="delivery_address" jdbcType="char" javaType="java.lang.String" property="deliveryAddress" />
  	 <result column="terms" jdbcType="char" javaType="java.lang.String" property="terms" />
  	<result column="memo" jdbcType="text" javaType="java.lang.String" property="memo" />
  	 <result column="status" jdbcType="char" javaType="java.lang.String" property="status" />
  	 <result column="splited_flg" jdbcType="int" javaType="java.lang.Integer" property="splitedFlg" />
  	 <result column="splited_sales_order_id" jdbcType="char" javaType="java.lang.String" property="spliteSalesOrderId" />
  	 <result column="print_times" jdbcType="int" javaType="java.lang.Integer" property="printTimes" />
  	 <result column="newest_print_time" jdbcType="datetime" javaType="java.util.Date" property="newestPrintTime" />
  	 <result column="newest_print_acc" jdbcType="char" javaType="java.lang.String" property="newestPrintAcc" />
  	 <result column="newest_print_record" jdbcType="char" javaType="java.lang.String" property="newestPrintRecord" />
  	 <result column="salesman_id" jdbcType="char" javaType="java.lang.String" property="salesManId" />
    <result column="ledger_id" jdbcType="char" javaType="java.lang.String" property="ledgerId" />
    <result column="operator" jdbcType="char" javaType="java.lang.String" property="operator" />
    <result column="modify_date" jdbcType="datetime" javaType="java.util.Date" property="modifyDate" />
    <result column="creater" jdbcType="char" javaType="java.lang.String" property="creater" />
    <result column="createdate" jdbcType="datetime" javaType="java.util.Date" property="createDate" />
    <result column="reviser" jdbcType="char" javaType="java.lang.String" property="reviser" />
    <result column="revisedate" jdbcType="datetime" javaType="java.util.Date" property="reviseDate" />
    <result column="verifier" jdbcType="char" javaType="java.lang.String" property="verifier" />    
    <result column="verifydate" jdbcType="datetime" javaType="java.util.Date" property="verifyDate"/>
  </resultMap>
  
  <sql id="whereLike">
  	<dynamic prepend="where">
  		1=1  AND 
  		<isNotNull prepend="and" property="sales_order_id">sales_order_id=#salesOrderId#</isNotNull>
		<isNotNull prepend="and" property="customerId">customer_id=#customerId#</isNotNull>
		<isNotNull prepend="and" property="customerName">customer_name LIKE CONCAT('%',#customerName#,'%')</isNotNull>
		<isNotNull prepend="and" property="linkMan">link_man LIKE CONCAT('%',#linkMan#,'%')</isNotNull>
		<isNotNull prepend="and" property="mobile">link_mobile=#mobile#</isNotNull>
		<isNotNull prepend="and" property="tel">tel=#tel#</isNotNull>
		<isNotNull prepend="and" property="fax">fax=#fax#</isNotNull>
		<isNotNull prepend="and" property="contractId">contract_id=#contractId#</isNotNull>
		<isNotNull prepend="and" property="totalAmount">total_amount=#totalAmount#</isNotNull>
		<isNotNull prepend="and" property="upperAmount">amount_in_words=#upperAmount#</isNotNull>
		<isNotNull prepend="and" property="orderedDate">ordered_date=#orderedDate#</isNotNull>
		<isNotNull prepend="and" property="deliveryDate">delivery_date=#deliveryDate#</isNotNull>
		<isNotNull prepend="and" property="deliveryAddress">delivery_address=#deliveryAddress#</isNotNull>
		<isNotNull prepend="and" property="terms">terms=#terms#</isNotNull>
		<isNotNull prepend="and" property="memo">memo=#memo#</isNotNull>
		<isNotNull prepend="and" property="status">status=#status#</isNotNull>
		<isNotNull prepend="and" property="splitedFlg">splited_flg=#splitedFlg#</isNotNull>
		<isNotNull prepend="and" property="spliteSalesOrderId">splited_sales_order_id=#spliteSalesOrderId#</isNotNull>
		<isNotNull prepend="and" property="printTimes">print_times=#printTimes#</isNotNull>
		<isNotNull prepend="and" property="newestPrintTime">newest_print_time=#newestPrintTime#</isNotNull>
		<isNotNull prepend="and" property="newestPrintAcc">newest_print_acc=#newestPrintAcc#</isNotNull>
		<isNotNull prepend="and" property="newestPrintRecord">newest_print_record=#newestPrintRecord#</isNotNull>
		<isNotNull prepend="and" property="salesManId">salesman_id=#salesManId#</isNotNull>
 		<isNotNull prepend="and" property="ledgerId">ledger_id=#ledgerId#</isNotNull> 
  	</dynamic>
  </sql>
 
	 <select id="getSalesOrderByPk" parameterClass="java.lang.String" resultMap="salesOrder">
	 	SELECT *
	 	FROM RS_SALES_ORDER
	 	WHERE sales_order_id=#salesOrderId#
	 </select>
	 
	 <select id="getSalesOrder" parameterClass="salesOrder" resultMap="salesOrder">
	 	SELECT *
	 	FROM RS_SALES_ORDER
	 	<include refid="whereLike"/>
	 </select>
   
   	<insert id="insert" parameterClass="salesOrder">
   		INSERT INTO RS_SALES_ORDER (
   			sales_order_id,
			<isNotNull	property="customerId">customer_id ,</isNotNull>
			<isNotNull	property="customerName">customer_name ,</isNotNull>
			<isNotNull	property="linkMan">link_man ,</isNotNull>
			<isNotNull	property="mobile">link_mobile,</isNotNull>
			<isNotNull	property="tel"> tel,</isNotNull>
			<isNotNull	property="fax"> fax,</isNotNull>
			<isNotNull	property="contractId">contract_id ,</isNotNull>
			<isNotNull	property="totalAmount">total_amount ,</isNotNull>
			<isNotNull	property="upperAmount">amount_in_words ,</isNotNull>
			<isNotNull	property="orderedDate">ordered_date ,</isNotNull>
			<isNotNull	property="deliveryDate">delivery_date ,</isNotNull>
			<isNotNull	property="deliveryAddress">delivery_address ,</isNotNull>
			<isNotNull	property="terms">terms ,</isNotNull>
			<isNotNull	property="memo"> memo,</isNotNull>
			<isNotNull	property="status"> status,</isNotNull>
			<isNotNull	property="splitedFlg">splited_flg ,</isNotNull>
			<isNotNull	property="spliteSalesOrderId">splited_sales_order_id ,</isNotNull>
			<isNotNull	property="printTimes">print_times ,</isNotNull>
			<isNotNull	property="newestPrintTime">newest_print_time ,</isNotNull>
			<isNotNull	property="newestPrintAcc">newest_print_acc ,</isNotNull>
			<isNotNull	property="newestPrintRecord">newest_print_record ,</isNotNull>
			<isNotNull	property="salesManId">salesman_id ,</isNotNull>
	 		<isNotNull  property="ledgerId">ledger_id,</isNotNull> 
	 		<isNotNull  property="operator">operator,</isNotNull>
	  	    creater,
	  	    createdate
   		)VALUES(
   			#salesOrderId#,
	  		<isNotNull  property="salesOrderId">#salesOrderId#,</isNotNull>
			<isNotNull  property="customerId">#customerId#,</isNotNull>
			<isNotNull  property="customerName">#customerName#,</isNotNull>
			<isNotNull  property="linkMan">#linkMan#,</isNotNull>
			<isNotNull  property="mobile">#mobile#,</isNotNull>
			<isNotNull  property="tel">#tel#,</isNotNull>
			<isNotNull  property="fax">#fax#,</isNotNull>
			<isNotNull  property="contractId">#contractId#,</isNotNull>
			<isNotNull  property="totalAmount">#totalAmount#,</isNotNull>
			<isNotNull  property="upperAmount">#upperAmount#,</isNotNull>
			<isNotNull  property="orderedDate">#orderedDate#,</isNotNull>
			<isNotNull  property="deliveryDate">#deliveryDate#,</isNotNull>
			<isNotNull  property="deliveryAddress">#deliveryAddress#,</isNotNull>
			<isNotNull  property="terms">#terms#,</isNotNull>
			<isNotNull  property="memo">#memo#,</isNotNull>
			<isNotNull  property="status">#status#,</isNotNull>
			<isNotNull  property="splitedFlg">#splitedFlg#,</isNotNull>
			<isNotNull  property="spliteSalesOrderId">#spliteSalesOrderId#,</isNotNull>
			<isNotNull  property="printTimes">#printTimes#,</isNotNull>
			<isNotNull  property="newestPrintTime">#newestPrintTime#,</isNotNull>
			<isNotNull  property="newestPrintAcc">#newestPrintAcc#,</isNotNull>
			<isNotNull  property="newestPrintRecord">#newestPrintRecord#,</isNotNull>
			<isNotNull  property="salesManId">#salesManId#,</isNotNull>
	 		<isNotNull  property="ledgerId">#ledgerId#,</isNotNull> 
	 		<isNotNull  property="operator">#operator#,</isNotNull>
   			 creater,now()
   		)
   	</insert>
   
   	<update id="updateSalesOrderByPK" parameterClass="salesOrder">
   		UPDATE RS_SALES_ORDER
   		<dynamic prepend="SET">
	  		<isNotNull prepend="," property="salesOrderId">sales_order_id =#salesOrderId#</isNotNull> 
			<isNotNull prepend="," property="customerId">customer_id =#customerId#</isNotNull>
			<isNotNull prepend="," property="customerName">customer_name =#customerName#</isNotNull>
			<isNotNull prepend="," property="linkMan">link_man =#linkMan#</isNotNull>
			<isNotNull prepend="," property="mobile">link_mobile =#mobile#</isNotNull>
			<isNotNull prepend="," property="tel">tel =#tel#</isNotNull>
			<isNotNull prepend="," property="fax">fax =#fax#</isNotNull>
			<isNotNull prepend="," property="contractId">contract_id =#contractId#</isNotNull>
			<isNotNull prepend="," property="totalAmount">total_amount =#totalAmount#</isNotNull>
			<isNotNull prepend="," property="upperAmount">amount_in_words =#upperAmount#</isNotNull>
			<isNotNull prepend="," property="orderedDate">ordered_date =#orderedDate#</isNotNull>
			<isNotNull prepend="," property="deliveryDate">delivery_date =#deliveryDate#</isNotNull>
			<isNotNull prepend="," property="deliveryAddress">delivery_address =#deliveryAddress#</isNotNull>
			<isNotNull prepend="," property="terms">terms =#terms#</isNotNull>
			<isNotNull prepend="," property="memo">memo =#memo#</isNotNull>
			<isNotNull prepend="," property="status">status =#status#</isNotNull>
			<isNotNull prepend="," property="splitedFlg">splited_flg =#splitedFlg#</isNotNull>
			<isNotNull prepend="," property="spliteSalesOrderId">splited_sales_order_id =#spliteSalesOrderId#</isNotNull>
			<isNotNull prepend="," property="printTimes">print_times =#printTimes#</isNotNull>
			<isNotNull prepend="," property="newestPrintTime">newest_print_time =#newestPrintTime#</isNotNull>
			<isNotNull prepend="," property="newestPrintAcc">newest_print_acc =#newestPrintAcc#</isNotNull>
			<isNotNull prepend="," property="newestPrintRecord">newest_print_record =#newestPrintRecord#</isNotNull>
			<isNotNull prepend="," property="salesManId">salesman_id =#salesManId#</isNotNull>
	 		<isNotNull prepend="," property="ledgerId">ledger_id=#ledgerId#</isNotNull> 
	 		<isNotNull prepend="," property="operator">operator=#operator#,modify_date= now()</isNotNull>
  	 		<isNotNull  prepend="," property="reviser">reviser = #reviser#,revisedate = now() </isNotNull>
  			<isNotNull  prepend="," property="verifier">verifier = #verifier#,verifydate = now() </isNotNull>
   		</dynamic>
   		WHERE sales_order_id=#salesOrderId#
   	</update>
   	<!-- 分页查询语句 -->
   	<select id="getSalesOrderSplitPageBySQL" remapResults="true" parameterClass="java.lang.String" resultMap="salesOrder">
   		$splitPageSQL$
   	</select>
   	<!-- end -->
   	
   	<select id="getSalesOrderSplitPageCountSQL" remapResults="true" parameterClass="java.lang.String" resultClass="java.lang.Integer">
   		$countSQL$
   	</select>
   	
   	<delete id="deleteSalesOrder" parameterClass="salesOrder">
   		DELETE FROM RS_SALES_ORDER
   		<include refid="whereLike"/>
   	</delete>
   	<delete id="deleteSalesOrderByPK" parameterClass="java.lang.String">
   		DELETE FROM RS_SALES_ORDER
   		WHERE sales_order_id=#salesOrderId#
   	</delete>
   	
   	<update id="updateSalesOrderStatusBySalesOrderId" parameterClass="salesOrder">
   		UPDATE RS_SALES_ORDER
   		SET `status`=#stats#
   		WHERE sales_order_id=#salesOrderId#
   	</update>
   	<!-- 未验证方法 -->
   	<select id="getSalesOrderBySupplierId" parameterClass="java.lang.String" resultMap="salesOrder">
   		SELECT so.* 
		FROM `rs_sales_order` AS  so ,(
			SELECT sogg.`sales_order_id` sales_order_id 
			FROM `rs_supplier_goods`  sg
			INNER JOIN `rs_sales_order_goods_grd` sogg  
			ON sg.`goods_id`= sogg.`goods_id`
			AND sg.`supplier_id` =#supplierId# 
		)  AS temp 
		WHERE temp.sales_order_id = so.`sales_order_id`
   	</select>
   	<select id="getSalesOrderByGoodsIds" parameterClass="java.util.Map" resultMap="salesOrder">
   		SELECT so.* 
		FROM RS_SALES_ORDER  so
		LEFT JOIN RS_SALES_ORDER_GOODS_GRD sogg 
		ON so.sales_order_id =sogg.sales_order_id
		WHERE sogg.goods_id in($goodsIds$)
		<dynamic>
			<isNotNull property="salesOrderId">
				AND so.sales_order_id =#salesOrderId#
			</isNotNull>
		</dynamic>
   	</select>
</sqlMap>